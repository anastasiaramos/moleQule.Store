
SET SEARCH_PATH = "0001";

/*SELECT OD."FECHA"
	,OD."CODIGO"
	,EX."CODIGO"
	,ODL.*	
FROM "STDeliveryLine" AS ODL
INNER JOIN "STDelivery" AS OD ON OD."OID" = ODL."OID_ALBARAN"
LEFT JOIN "STExpedient" AS EX ON EX."OID" = ODL."OID_EXPEDIENTE"
WHERE ODL."OID" NOT IN (SELECT "OID_CONCEPTO" FROM "STLivestockBookLine" WHERE "TIPO" = 1)
	AND OD."OID_SERIE" = 2
	AND (ODL."CONCEPTO" LIKE '%DK%'  OR ODL."CONCEPTO" LIKE 'DK%')
	--AND (ODL."CONCEPTO" LIKE 'NL%'OR ODL."CONCEPTO" LIKE '%NL%')
	AND OD."FECHA" >= '03/08/2012';*/

SELECT ID."FECHA"
	,ID."CODIGO" AS "COD_ALBARAN"
	,IV."CODIGO" AS "COD_FACTURA"
	,EX."CODIGO"
	,IDL.*	
FROM "IVDeliveryLine" AS IDL
INNER JOIN "IVDelivery" AS ID ON ID."OID" = IDL."OID_ALBARAN"
INNER JOIN "IVDelivery_Invoice" AS IDI ON IDI."OID_ALBARAN" = ID."OID"
INNER JOIN "IVInvoice" AS IV ON IV."OID" = IDI."OID_FACTURA"
LEFT JOIN "STExpedient" AS EX ON EX."OID" = IDL."OID_EXPEDIENTE"
WHERE IDL."OID" NOT IN (SELECT "OID_CONCEPTO" FROM "STLivestockBookLine" WHERE "TIPO" = 2)
	AND ID."OID_SERIE" = 2
	AND (IDL."CONCEPTO" LIKE '%NOVILLA%' OR IDL."CONCEPTO" LIKE 'NOVILLA%' OR IDL."CONCEPTO" LIKE '%TERNER%'  OR IDL."CONCEPTO" LIKE 'TERNER%')
	AND ID."FECHA" >= '03/08/2012'
ORDER BY ID."FECHA" ASC;

/*INSERT INTO "STLivestockBookLine" ("OID_CONCEPTO",
					"OID_PARTIDA",
					"OID_LIBRO", 
					"SERIAL",
					"CODIGO",
					"ESTADO",	
					  "CROTAL",
					  "FECHA",
					  "SEXO",
					  "CAUSA" ,
					  "PROCEDENCIA",
					  "TIPO")
(SELECT 
	ODL."OID", 
	ODL."OID_BATCH",
	1,
	0,
	'00000',
	18,
	ODL."CONCEPTO",
	OD."FECHA",	
	2,
	'IMPORTACIÓN',
	'DINAMARCA',
	1	
FROM "STDeliveryLine" AS ODL
INNER JOIN "STDelivery" AS OD ON OD."OID" = ODL."OID_ALBARAN"
LEFT JOIN "STExpedient" AS EX ON EX."OID" = ODL."OID_EXPEDIENTE"
WHERE ODL."OID" NOT IN (SELECT "OID_CONCEPTO" FROM "STLivestockBookLine" WHERE "TIPO" = 1)
AND OD."OID_SERIE" = 2
AND (ODL."CONCEPTO" LIKE '%DK%'  OR ODL."CONCEPTO" LIKE 'DK%')
--AND (ODL."CONCEPTO" LIKE 'NL%'OR ODL."CONCEPTO" LIKE '%NL%')
AND OD."FECHA" >= '03/08/2012');*/

/*INSERT INTO "STLivestockBookLine" ("OID_CONCEPTO",
					"OID_PARTIDA",
					"OID_LIBRO", 
					"SERIAL",
					"CODIGO",
					"ESTADO",	
					  "CROTAL",
					  "FECHA",
					  "SEXO",
					  "CAUSA" ,
					  "TIPO")
(SELECT 
	ODL."OID", 
	ODL."OID_BATCH",
	1,
	99999,
	'99999',
	11,
	LL."CROTAL",
	OD."FECHA",	
	2,
	'Venta',
	2
FROM "IVDeliveryLine" AS ODL
INNER JOIN "IVDelivery" AS OD ON OD."OID" = ODL."OID_ALBARAN"
INNER JOIN "STLivestockBookLine" AS LL ON LL."OID_PARTIDA" = ODL."OID_BATCH" AND LL."TIPO" = 1
WHERE ODL."OID" NOT IN (SELECT "OID_CONCEPTO" FROM "STLivestockBookLine" WHERE "TIPO" = 2)
AND OD."OID_SERIE" = 2
AND (ODL."CONCEPTO" LIKE '%NOVILLA%' OR ODL."CONCEPTO" LIKE 'NOVILLA%')
AND OD."FECHA" >= '03/08/2012');  */