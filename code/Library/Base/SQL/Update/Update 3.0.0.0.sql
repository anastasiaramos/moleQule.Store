/* UPDATE 3.0.0.0*/

SET SEARCH_PATH = "COMMON";

INSERT INTO "Variable" ("NAME", "VALUE") VALUES ('DEFAULT_SERIE_COMPRA', '1');

ALTER TABLE "Familia" ADD COLUMN "OID_IMPUESTO" bigint;
ALTER TABLE "Serie" ADD COLUMN "OID_IMPUESTO" bigint;
ALTER TABLE "Despachante" ADD COLUMN "OID_IMPUESTO" bigint;
--ALTER TABLE "Empleado" ADD COLUMN "OID_IMPUESTO" text;
ALTER TABLE "Naviera" ADD COLUMN "OID_IMPUESTO" bigint;
ALTER TABLE "Proveedor" ADD COLUMN "OID_IMPUESTO" bigint;
ALTER TABLE "Transportista" ADD COLUMN "OID_IMPUESTO" bigint;

INSERT INTO "Impuesto" ("NOMBRE", "PORCENTAJE") VALUES ('EXENTO', 0.00);
INSERT INTO "Impuesto" ("NOMBRE", "PORCENTAJE") VALUES ('IGIC AL 2%', 2.00);
INSERT INTO "Impuesto" ("NOMBRE", "PORCENTAJE") VALUES ('IGIC AL 5%', 5.00);

UPDATE "Serie" SET "OID_IMPUESTO" = IP."OID" 
FROM "Impuesto" AS IP
WHERE "Serie"."IGIC" = IP."PORCENTAJE";

ALTER TABLE "Serie" ADD COLUMN "TIPO" bigint DEFAULT 0;
ALTER TABLE "Serie" DROP COLUMN "IGIC";
ALTER TABLE "Serie" DROP COLUMN "VENTA";

UPDATE "Serie" SET "TIPO" = 3; 

ALTER TABLE "Familia" RENAME COLUMN "CUENTA_CONTABLE" TO "CUENTA_CONTABLE_COMPRA";
ALTER TABLE "Familia" ADD COLUMN "CUENTA_CONTABLE_VENTA" varchar(255);

UPDATE "Proveedor" SET "TIPO_ID" = 1 WHERE "TIPO_ID" = 0; 
UPDATE "Proveedor" SET "TIPO_ID" = 0 WHERE "TIPO_ID" = 16; 
UPDATE "Despachante" SET "TIPO_ID" = 1 WHERE "TIPO_ID" = 0; 
UPDATE "Despachante" SET "TIPO_ID" = 0 WHERE "TIPO_ID" = 16; 
UPDATE "Naviera" SET "TIPO_ID" = 1 WHERE "TIPO_ID" = 0; 
UPDATE "Naviera" SET "TIPO_ID" = 0 WHERE "TIPO_ID" = 16; 
UPDATE "Transportista" SET "TIPO_ID" = 1 WHERE "TIPO_ID" = 0; 
UPDATE "Transportista" SET "TIPO_ID" = 0 WHERE "TIPO_ID" = 16; 

ALTER TABLE "Despachante" ADD COLUMN "ALIAS" varchar(255);
ALTER TABLE "Empleado" ADD COLUMN "ALIAS" varchar(255);
ALTER TABLE "Naviera" ADD COLUMN "ALIAS" varchar(255);
ALTER TABLE "Proveedor" ADD COLUMN "ALIAS" varchar(255);
ALTER TABLE "Transportista" ADD COLUMN "ALIAS" varchar(255);

SET SEARCH_PATH = "0001";

ALTER TABLE "Producto" RENAME COLUMN "OID_IMPUESTO" TO "OID_IMPUESTO_COMPRA";
ALTER TABLE "Producto" ADD COLUMN "OID_IMPUESTO_VENTA" bigint;
ALTER TABLE "Producto" DROP COLUMN "OID_SERIE";
ALTER TABLE "Producto" DROP COLUMN "NOMBRE_SERIE";
ALTER TABLE "Producto" DROP COLUMN "NUMERO_SERIE";

ALTER TABLE "ConceptoFacturaRecibida" ADD COLUMN "FACTURACION_BULTO" boolean DEFAULT FALSE;

ALTER TABLE "Pago" ADD COLUMN "GASTOS_BANCARIOS" decimal(10,2) DEFAULT 0;
ALTER TABLE "Pago" ADD COLUMN "ESTADO" bigint DEFAULT 1;

ALTER TABLE "Producto" ADD COLUMN "CUENTA_CONTABLE_COMPRA" varchar(255);
ALTER TABLE "Producto" ADD COLUMN "CUENTA_CONTABLE_VENTA" varchar(255);

ALTER TABLE "AlbaranProveedor" DROP CONSTRAINT "AlbaranProveedor_SERIAL_OID_SERIE_key";
ALTER TABLE "AlbaranProveedor" DROP CONSTRAINT "AlbaranProveedor_SERIAL_key";
ALTER TABLE "FacturaRecibida" DROP CONSTRAINT "FacturaProveedor_SERIAL_key";

